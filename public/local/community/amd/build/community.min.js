/**
 * Global Community AMD module for Moodle 5.1.
 *
 * @module     local_community/community
 * @copyright  2026 Youssef Khaled
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_community/community",["jquery","core/modal_factory","core/modal_events","core/notification"],(function($,ModalFactory,ModalEvents,Notification){const Selectors_container="#community-app",Selectors_askBtn="#ask-question-btn";function loadPosts(){fetch("".concat(M.cfg.wwwroot,"/local/community/ajax/get_posts.php")).then((res=>res.json())).then((res=>{!function(posts){let html='\n            <div class="d-flex justify-content-between align-items-center mb-4">\n                <h2 class="h4 fw-bold text-dark">Community Discussions</h2>\n                <button id="ask-question-btn" class="btn btn-primary rounded-pill px-4 shadow-sm">\n                    <i class="fa fa-plus me-2"></i>Ask Question\n                </button>\n            </div>\n            <div class="row" id="posts-grid">\n        ';0===posts.length&&(html+='\n                <div class="col-12 text-center py-5">\n                    <div class="alert alert-light border-dashed">\n                        No discussions yet. Start the conversation!\n                    </div>\n                </div>'),posts.forEach((p=>{html+='\n                <div class="col-12 mb-3">\n                    <div class="card h-100 border-0 shadow-sm transition">\n                        <div class="card-body d-flex align-items-center">\n                            <div class="vote-count text-center me-4 border-end pe-4" style="min-width: 80px;">\n                                <span class="d-block h4 mb-0 fw-bold text-primary">'.concat(p.votes,'</span>\n                                <small class="text-muted text-uppercase small fw-semibold">Votes</small>\n                            </div>\n                            <div class="post-content">\n                                <h5 class="card-title mb-1">\n                                    <a href="').concat(M.cfg.wwwroot,"/local/community/pages/post.php?id=").concat(p.id,'"\n                                       class="text-decoration-none text-dark stretched-link">\n                                        ').concat(p.title,'\n                                    </a>\n                                </h5>\n                                <p class="card-text small text-muted mb-0">\n                                    <span class="me-2">\n                                        <i class="fa fa-user-circle me-1"></i>').concat(p.firstname," ").concat(p.lastname,"\n                                    </span>\n                                </p>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            ")})),html+="</div>",$(Selectors_container).html(html)}(res)})).catch(Notification.exception)}function initModal(){ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:"Ask a New Question",body:'\n                <div class="p-2">\n                    <div class="mb-3">\n                        <label for="post-title" class="form-label fw-bold">Title</label>\n                        <input type="text" class="form-control shadow-none" id="post-title"\n                               placeholder="e.g. How do I use the new Moodle 5.1 Gradebook?">\n                    </div>\n                    <div class="mb-3">\n                        <label for="post-content" class="form-label fw-bold">Details</label>\n                        <textarea class="form-control shadow-none" id="post-content" rows="5"\n                                  placeholder="Explain your question in detail..."></textarea>\n                    </div>\n                </div>\n            ',buttons:{save:"Post Question"}}).then((modal=>{$(document).on("click",Selectors_askBtn,(e=>{e.preventDefault(),modal.show()})),modal.getRoot().on(ModalEvents.save,(e=>{const title=$("#post-title").val(),content=$("#post-content").val();if(!title||!content)return e.preventDefault(),void Notification.addNotification({message:"Both fields are required",type:"error"});!function(title,content,modal){fetch("".concat(M.cfg.wwwroot,"/local/community/ajax/create_post.php"),{method:"POST",body:JSON.stringify({title:title,content:content,posttype:"question"})}).then((()=>{modal.hide(),loadPosts(),Notification.addNotification({message:"Question posted!",type:"success"})}))}(title,content,modal)}))}))}return{init:()=>{loadPosts(),initModal()}}}));

//# sourceMappingURL=community.min.js.map