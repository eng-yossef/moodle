/**
 * Global Community AMD module for Moodle 5.1.
 *
 * @module     local_community/community
 * @copyright  2026 Youssef Khaled
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_community/community",["jquery","core/modal_factory","core/modal_events","core/notification"],(function($,ModalFactory,ModalEvents,Notification){const Selectors_container="#community-app",Selectors_askBtn="#ask-question-btn";function loadPosts(){fetch("".concat(M.cfg.wwwroot,"/local/community/ajax/get_posts.php")).then((res=>res.json())).then((res=>{!function(posts){let html='\n            <div class="d-flex justify-content-between align-items-center mb-4">\n                <h2 class="h4 fw-bold text-dark">Community Discussions</h2>\n                <button id="ask-question-btn" class="btn btn-primary rounded-pill px-4 shadow-sm">\n                    <i class="fa fa-plus me-2"></i>Ask Question\n                </button>\n            </div>\n            <div class="row" id="posts-grid">\n        ';0===posts.length&&(html+='\n                <div class="col-12 text-center py-5">\n                    <div class="alert alert-light border-dashed">\n                        No discussions yet. Start the conversation!\n                    </div>\n                </div>'),posts.forEach((p=>{const deleteBtn=p.can_delete?'\n        <button class="btn btn-sm btn-danger delete-post ms-3"\n                data-id="'.concat(p.id,'">\n            <i class="fa fa-trash"></i>\n        </button>\n    '):"";html+='\n        <div class="col-12 mb-3">\n            <div class="card h-100 border-0 shadow-sm">\n                <div class="card-body d-flex align-items-center">\n\n                    <div class="vote-count text-center me-4 border-end pe-4" style="min-width: 80px;">\n                        <span class="h4 fw-bold text-primary">'.concat(p.votes,'</span>\n                        <small class="text-muted">Votes</small>\n                    </div>\n\n                    <div class="vote-count text-center me-4 border-end pe-4" style="min-width: 80px;">\n                        <span class="h4 fw-bold text-primary">').concat(p.answers,'</span>\n                        <small class="text-muted">Answers</small>\n                    </div>\n\n                    <div class="post-content flex-grow-1">\n                        <h5>\n                            <a href="').concat(M.cfg.wwwroot,"/local/community/pages/post.php?id=").concat(p.id,'"\n                               class="text-dark text-decoration-none">\n                                ').concat(p.title,'\n                            </a>\n                        </h5>\n\n                        <small class="text-muted d-block">\n    <i class="fa fa-user-circle"></i>\n    ').concat(p.firstname," ").concat(p.lastname,'\n</small>\n\n<small class="text-warning fw-bold d-block">\n    ‚≠ê ').concat(p.reputation,'\n</small>\n\n<div class="mt-1">\n    ').concat(p.badges.map((b=>'<span class="badge bg-light text-dark border me-1">\n                <i class="fa '.concat(b.icon,' text-warning"></i> ').concat(b.name,"\n            </span>"))).join(""),"\n</div>\n                    </div>\n\n                    ").concat(deleteBtn,"\n\n                </div>\n            </div>\n        </div>\n    ")})),html+="</div>",$(Selectors_container).html(html)}(res)})).catch(Notification.exception)}function initModal(){ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:"Ask a New Question",body:'\n            <div class="p-2">\n                <div class="mb-3">\n                    <label for="post-title" class="form-label fw-bold">Title</label>\n                    <input type="text" class="form-control shadow-none" id="post-title"\n                           placeholder="e.g. How do I use the new Moodle 5.1 Gradebook?">\n                    <div id="similar-questions" class="mt-2"></div>\n                </div>\n                <div class="mb-3">\n                    <label for="post-content" class="form-label fw-bold">Details</label>\n                    <textarea class="form-control shadow-none" id="post-content" rows="5"\n                              placeholder="Explain your question in detail..."></textarea>\n                </div>\n            </div>\n        ',buttons:{save:"Post Question"}}).then((modal=>{$(document).on("click",Selectors_askBtn,(e=>{e.preventDefault(),modal.show()})),modal.getRoot().on("input","#post-title",(function(){const title=$(this).val();title.length<3?$("#similar-questions").empty():fetch(M.cfg.wwwroot+"/local/community/ajax/similar.php?q="+encodeURIComponent(title)).then((res=>res.json())).then((function(data){if(!data.length)return void $("#similar-questions").html("<small>No similar questions found.</small>");let html='<h6>ü§ñ AI Similar Questions</h6><ul class="list-unstyled">';data.forEach((function(item){html+='<li>\n                        <a href="'.concat(M.cfg.wwwroot,"/local/community/pages/post.php?id=").concat(item.id,'">').concat(item.title,"</a>\n                        </li>")})),html+="</ul>",$("#similar-questions").html(html)}))})),modal.getRoot().on(ModalEvents.save,(e=>{const title=$("#post-title").val(),content=$("#post-content").val();if(!title||!content)return e.preventDefault(),void Notification.addNotification({message:"Both fields are required",type:"error"});!function(title,content,modal){fetch("".concat(M.cfg.wwwroot,"/local/community/ajax/create_post.php"),{method:"POST",body:JSON.stringify({title:title,content:content,posttype:"question"})}).then((()=>{modal.hide(),loadPosts(),Notification.addNotification({message:"Question posted!",type:"success"})}))}(title,content,modal)}))}))}return{init:()=>{loadPosts(),initModal(),$(document).on("click",".delete-post",(function(e){e.preventDefault();const id=$(this).data("id");Notification.confirm("Delete post","Do you really want to delete this post?","Yes","Cancel",(()=>{fetch("".concat(M.cfg.wwwroot,"/local/community/ajax/delete_post.php"),{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({postid:id,sesskey:M.cfg.sesskey})}).then((r=>r.json())).then((data=>{"success"===data.status?loadPosts():Notification.alert("Error",data.message,"OK")})).catch(Notification.exception)}))}))}}}));

//# sourceMappingURL=community.min.js.map