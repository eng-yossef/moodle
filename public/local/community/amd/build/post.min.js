/**
 * Post details page logic for Moodle 5.1.
 *
 * @module      local_community/post
 * @copyright   2026 Youssef Khaled
 * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_community/post",["jquery","core/notification"],(function($,Notification){let currentPostId=null;const SELECTORS_container="#post-data-container",SELECTORS_answerInput="#answercontent",SELECTORS_submitBtn="#addanswer";function timeAgo(timestamp){const now=new Date,time=new Date(1e3*timestamp),diff=Math.floor((now-time)/1e3);return diff<60?"".concat(diff," seconds ago"):diff<3600?"".concat(Math.floor(diff/60)," minutes ago"):diff<86400?"".concat(Math.floor(diff/3600)," hours ago"):diff<2592e3?"".concat(Math.floor(diff/86400)," days ago"):time.toLocaleDateString()}async function loadPost(){const $container=$(SELECTORS_container);$container.css("opacity","0.5");try{const response=await fetch("".concat(M.cfg.wwwroot,"/local/community/ajax/get_post.php?id=").concat(currentPostId));!function(data){const{post:post,answers:answers}=data;let html='\n            <div class="post-container mb-5 animate__animated animate__fadeIn">\n                <div class="border-bottom pb-3 mb-4">\n                    <h1 class="display-6 fw-bold text-dark mb-2">'.concat(post.title,'</h1>\n                    <div class="d-flex align-items-center flex-wrap gap-3 text-muted small">\n                    <div class="me-3">\n        <i class="fa fa-calendar-o me-1"></i> Asked ').concat(timeAgo(post.timecreated),'\n    </div>\n                        <div><i class="fa fa-eye me-1"></i> Viewed ').concat(post.views||0,' times</div>\n                        <div class="badge bg-light text-dark border">\n                            <i class="fa fa-star text-warning me-1"></i>').concat(post.votes,' Score\n                        </div>\n                    </div>\n                </div>\n\n                <div class="row">\n                    <div class="col-12 mt-2">\n                        <div class="post-body fs-5 text-dark mb-4">').concat(post.content,'</div>\n                        <div class="d-flex justify-content-end">\n                            <div class="user-info-card p-3 rounded bg-light border-start border-primary border-4"\n                                 style="min-width: 180px;">\n                                <span class="text-muted d-block small mb-2">Asked by</span>\n                                <div class="author-info">\n                                    <div class="fw-bold text-primary mb-1">\n                                        ').concat(post.firstname," ").concat(post.lastname,'\n                                    </div>\n                                    <div class="small text-muted mb-1">\n                                        <strong>').concat(post.reputation,'</strong> reputation\n                                    </div>\n                                    <div class="d-flex flex-wrap gap-1">\n                                        ').concat(post.badges.map((b=>'\n                                            <span class="badge bg-secondary" style="font-size: 0.7rem;">\n                                                '.concat(b.name,"\n                                            </span>"))).join(""),'\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <div class="answers-header d-flex justify-content-between align-items-center mb-4">\n                <h4 class="fw-bold mb-0">').concat(answers.length,' Answers</h4>\n                <div class="dropdown">\n                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button">\n                        Sort by: Votes\n                    </button>\n                </div>\n            </div>');answers.forEach((a=>{const upActive=1===a.uservote?"text-success":"text-muted",downActive=-1===a.uservote?"text-danger":"text-muted",upDisabled=1===a.uservote?"disabled":"",downDisabled=-1===a.uservote?"disabled":"";html+='\n                <div class="answer-card card border-0 shadow-sm mb-4">\n                    <div class="card-body p-4">\n                        <div class="d-flex">\n                            <div class="d-flex flex-column align-items-center me-4">\n                                <button class="btn btn-link p-0 vote-answer '.concat(upActive,'"\n                                        data-id="').concat(a.id,'" data-value="1" ').concat(upDisabled,' title="Upvote">\n                                    <i class="fa fa-chevron-up fa-2x"></i>\n                                </button>\n                                <span class="fw-bold fs-4 my-1">').concat(a.votes,'</span>\n                                <button class="btn btn-link p-0 vote-answer ').concat(downActive,'"\n                                        data-id="').concat(a.id,'" data-value="-1" ').concat(downDisabled,' title="Downvote">\n                                    <i class="fa fa-chevron-down fa-2x"></i>\n                                </button>\n                            </div>\n\n                            <div class="flex-grow-1">\n                                <div class="answer-text mb-4 text-dark" style="line-height: 1.6;">').concat(a.content,'</div>\n                                <div class="d-flex justify-content-between align-items-center mt-3">\n                                    <div class="actions">\n                                        ').concat(a.can_delete?'\n                                            <button class="btn btn-link btn-sm text-danger p-0 delete-answer" data-id="'.concat(a.id,'">\n                                                <i class="fa fa-trash me-1"></i>Delete\n                                            </button>'):"",'\n                                    </div>\n                                    <div class="user-meta small p-2 rounded bg-light border">\n                                        <span class="text-muted">answered by</span>\n                                        <span class="fw-bold text-dark">').concat(a.firstname," â€¢ ").concat(timeAgo(a.timecreated),'</span>\n                                        <span class="text-primary mx-1">').concat(a.reputation,"</span>\n                                        ").concat(a.badges.map((b=>'<span class="badge bg-info text-white ms-1">'.concat(b.name,"</span>"))).join(""),"\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>")})),$(SELECTORS_container).html(html)}(await response.json())}catch(error){Notification.exception(error)}finally{$container.css("opacity","1")}}return{init:function(postid){currentPostId=postid,loadPost(),$(document).on("click",".vote-answer",(async function(e){e.preventDefault();const btn=$(this),answerId=btn.data("id"),value=btn.data("value");btn.closest(".d-flex.flex-column").find(".vote-answer").prop("disabled",!0).addClass("opacity-50");try{await fetch("".concat(M.cfg.wwwroot,"/local/community/ajax/vote.php"),{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({answerid:answerId,value:value,postid:currentPostId,sesskey:M.cfg.sesskey})}),await loadPost()}catch(error){Notification.exception(error)}})),$(document).on("click",SELECTORS_submitBtn,(async function(e){e.preventDefault();const $btn=$(this),content=$(SELECTORS_answerInput).val().trim();if(content){$btn.prop("disabled",!0).html('<i class="fa fa-circle-o-notch fa-spin"></i> Posting...');try{await fetch("".concat(M.cfg.wwwroot,"/local/community/ajax/create_answer.php"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({postid:currentPostId,content:content})}),$(SELECTORS_answerInput).val(""),await loadPost()}catch(error){Notification.exception(error)}finally{$btn.html("Post Your Answer")}}else Notification.addNotification({message:"Please enter a response before posting.",type:"error"})})),$(document).on("click",".delete-answer",(function(e){e.preventDefault();const id=$(this).data("id");Notification.confirm("Confirm Deletion","This action cannot be undone. Are you sure you want to delete this answer?","Delete","Cancel",(async()=>{try{await fetch("".concat(M.cfg.wwwroot,"/local/community/ajax/delete_answer.php"),{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({answerid:id,sesskey:M.cfg.sesskey})}),await loadPost()}catch(error){Notification.exception(error)}}))})),$(document).on("input",SELECTORS_answerInput,(function(){const hasContent=$(this).val().trim().length>0;$(SELECTORS_submitBtn).prop("disabled",!hasContent)}))}}}));

//# sourceMappingURL=post.min.js.map