{"version":3,"file":"post.min.js","sources":["../src/post.js"],"sourcesContent":["/**\n * Post details page logic for Moodle 5.1.\n *\n * @module     local_community/post\n * @copyright  2026 Youssef Khaled\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/notification'], function($, Notification) {\n\n    let currentPostId = null;\n\n    /**\n     * Render the post details and answers into the container.\n     *\n     * @param {Object} data The post and answers data.\n     */\n    function render(data) {\n        const {post, answers} = data;\n        let html = `\n            <div class=\"post-content mb-5\">\n                <h1 class=\"display-6 fw-bold text-dark\">${post.title}</h1>\n                <div class=\"d-flex align-items-center text-muted small mt-2 border-bottom pb-3\">\n                    <div class=\"me-3\"><i class=\"fa fa-user me-1\"></i> ${post.firstname} ${post.lastname}</div>\n                    <div class=\"badge bg-light text-dark border\">${post.votes} total votes</div>\n                </div>\n                <div class=\"mt-4 fs-5 text-dark\">${post.content}</div>\n            </div>\n            <h4 class=\"fw-bold mb-4\">${answers.length} Answers</h4>\n        `;\n\n       answers.forEach(a => {\n    const upDisabled = a.uservote === 1 ? 'disabled' : '';\n    const downDisabled = a.uservote === -1 ? 'disabled' : '';\n\n    html += `\n        <div class=\"card border-0 shadow-sm mb-3\">\n            <div class=\"card-body d-flex\">\n\n                <div class=\"d-flex flex-column align-items-center me-4 bg-light rounded p-2\"\n                     style=\"height: fit-content; min-width: 50px;\">\n\n                    <button class=\"btn btn-link link-success p-0 vote-answer\" \n                            data-id=\"${a.id}\" data-value=\"1\" ${upDisabled}>\n                        <i class=\"fa fa-chevron-up\"></i>\n                    </button>\n\n                    <span class=\"fw-bold my-1\">${a.votes}</span>\n\n                    <button class=\"btn btn-link link-danger p-0 vote-answer\" \n                            data-id=\"${a.id}\" data-value=\"-1\" ${downDisabled}>\n                        <i class=\"fa fa-chevron-down\"></i>\n                    </button>\n\n                </div>\n\n                <div class=\"flex-grow-1\">\n                    <div class=\"mb-2\">${a.content}</div>\n                    <div class=\"text-muted small\">\n                        Answered by <strong>${a.firstname}</strong>\n                    </div>\n                </div>\n\n                ${a.can_delete ? `\n                    <button class=\"btn btn-sm btn-danger delete-answer ms-2\"\n                            data-id=\"${a.id}\">\n                        <i class=\"fa fa-trash\"></i>\n                    </button>\n                ` : ''}\n\n            </div>\n        </div>\n    `;\n});\n\n        $('#post-data-container').html(html);\n    }\n\n    /**\n     * Refresh post data from the server.\n     */\n    function loadPost() {\n        fetch(`${M.cfg.wwwroot}/local/community/ajax/get_post.php?id=${currentPostId}`)\n            .then(res => res.json())\n            .then(render)\n            .catch(Notification.exception);\n    }\n\n    /**\n     * Initialize the post page logic.\n     *\n     * @param {Number} postid The post ID.\n     */\n    function init(postid) {\n        currentPostId = postid;\n        loadPost();\n\n        // Handle voting\n        $(document).on('click', '.vote-answer', function(e) {\n            e.preventDefault();\n            const btn = $(this);\n            const answerId = btn.data('id');\n            const value = btn.data('value');\n\n            // Disable both buttons immediately to prevent multiple clicks\n            const container = btn.closest('.d-flex.flex-column');\n            container.find('.vote-answer').prop('disabled', true);\n\n            fetch(`${M.cfg.wwwroot}/local/community/ajax/vote.php`, {\n    method: 'POST',\n    headers: {\n        'Content-Type': 'application/x-www-form-urlencoded'\n    },\n    body: new URLSearchParams({\n        answerid: answerId,\n        value: value,\n        postid: currentPostId,\n        sesskey: M.cfg.sesskey\n    })\n})\n.then(() => loadPost())\n.catch(Notification.exception);\n        });\n\n        //addanswer\n        $(document).on('click', '#addanswer', function(e) {\n            e.preventDefault();\n            const content = $('#answercontent').val();\n            if (!content.trim()) {\n                Notification.addNotification({\n                    message: 'Please enter an answer.',\n                    type: 'error'\n                });\n                return;\n            }\n\n            fetch(`${M.cfg.wwwroot}/local/community/ajax/create_answer.php`, {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({ postid: currentPostId, content: content })\n            })\n            .then(() => {\n                $('#answercontent').val('');\n                loadPost(); // Reload post to show new answer\n            })\n            .catch(Notification.exception);\n        });\n\n\n$(document).on('click', '.delete-answer', function(e) {\n    e.preventDefault();\n\n    const id = $(this).data('id');\n\n    Notification.confirm(\n        'Delete',\n        'Do you really want to delete this answer?',\n        'Yes',\n        'Cancel',\n        () => {\n\n            fetch(`${M.cfg.wwwroot}/local/community/ajax/delete_answer.php`, {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/x-www-form-urlencoded'\n                },\n                body: new URLSearchParams({\n                    answerid: id,\n                    sesskey: M.cfg.sesskey\n                })\n            })\n            .then(res => res.json())\n            .then(() => loadPost())\n            .catch(Notification.exception);\n\n        }\n    );\n});\n\n        // Handle answer text input changes\n        $(document).on('input', '#answercontent', function() {\n            const content = $(this).val();\n            if (content.trim().length > 0) {\n                $('#addanswer').prop('disabled', false);\n            } else {\n                $('#addanswer').prop('disabled', true);\n            }\n        });\n\n    }\n\n    return { init: init };\n});\n"],"names":["define","$","Notification","currentPostId","render","data","post","answers","html","title","firstname","lastname","votes","content","length","forEach","a","upDisabled","uservote","downDisabled","id","can_delete","loadPost","fetch","M","cfg","wwwroot","then","res","json","catch","exception","init","postid","document","on","e","preventDefault","btn","this","answerId","value","closest","find","prop","method","headers","body","URLSearchParams","answerid","sesskey","val","trim","JSON","stringify","addNotification","message","type","confirm"],"mappings":";;;;;;;AAOAA,8BAAO,CAAC,SAAU,sBAAsB,SAASC,EAAGC,kBAE5CC,cAAgB,cAOXC,OAAOC,YACNC,KAACA,KAADC,QAAOA,SAAWF,SACpBG,sHAE8CF,KAAKG,gMAESH,KAAKI,sBAAaJ,KAAKK,6FAC5BL,KAAKM,8GAErBN,KAAKO,oFAEjBN,QAAQO,kCAGxCP,QAAQQ,SAAQC,UACbC,WAA4B,IAAfD,EAAEE,SAAiB,WAAa,GAC7CC,cAA+B,IAAhBH,EAAEE,SAAkB,WAAa,GAEtDV,8YAQmCQ,EAAEI,+BAAsBH,mKAIdD,EAAEJ,gJAGZI,EAAEI,gCAAuBD,mOAOxBH,EAAEH,2HAEIG,EAAEN,sGAI9BM,EAAEK,0IAEmBL,EAAEI,+GAGrB,sDAOZnB,EAAE,wBAAwBO,KAAKA,eAM1Bc,WACLC,gBAASC,EAAEC,IAAIC,yDAAgDvB,gBAC1DwB,MAAKC,KAAOA,IAAIC,SAChBF,KAAKvB,QACL0B,MAAM5B,aAAa6B,iBA0GrB,CAAEC,cAlGKC,QACV9B,cAAgB8B,OAChBX,WAGArB,EAAEiC,UAAUC,GAAG,QAAS,gBAAgB,SAASC,GAC7CA,EAAEC,uBACIC,IAAMrC,EAAEsC,MACRC,SAAWF,IAAIjC,KAAK,MACpBoC,MAAQH,IAAIjC,KAAK,SAGLiC,IAAII,QAAQ,uBACpBC,KAAK,gBAAgBC,KAAK,YAAY,GAEhDrB,gBAASC,EAAEC,IAAIC,0CAAyC,CAChEmB,OAAQ,OACRC,QAAS,gBACW,qCAEpBC,KAAM,IAAIC,gBAAgB,CACtBC,SAAUT,SACVC,MAAOA,MACPR,OAAQ9B,cACR+C,QAAS1B,EAAEC,IAAIyB,YAGtBvB,MAAK,IAAML,aACXQ,MAAM5B,aAAa6B,cAIZ9B,EAAEiC,UAAUC,GAAG,QAAS,cAAc,SAASC,GAC3CA,EAAEC,uBACIxB,QAAUZ,EAAE,kBAAkBkD,MAC/BtC,QAAQuC,OAQb7B,gBAASC,EAAEC,IAAIC,mDAAkD,CAC7DmB,OAAQ,OACRC,QAAS,gBAAkB,oBAC3BC,KAAMM,KAAKC,UAAU,CAAErB,OAAQ9B,cAAeU,QAASA,YAE1Dc,MAAK,KACF1B,EAAE,kBAAkBkD,IAAI,IACxB7B,cAEHQ,MAAM5B,aAAa6B,WAhBhB7B,aAAaqD,gBAAgB,CACzBC,QAAS,0BACTC,KAAM,aAkB1BxD,EAAEiC,UAAUC,GAAG,QAAS,kBAAkB,SAASC,GAC/CA,EAAEC,uBAEIjB,GAAKnB,EAAEsC,MAAMlC,KAAK,MAExBH,aAAawD,QACT,SACA,4CACA,MACA,UACA,KAEInC,gBAASC,EAAEC,IAAIC,mDAAkD,CAC7DmB,OAAQ,OACRC,QAAS,gBACW,qCAEpBC,KAAM,IAAIC,gBAAgB,CACtBC,SAAU7B,GACV8B,QAAS1B,EAAEC,IAAIyB,YAGtBvB,MAAKC,KAAOA,IAAIC,SAChBF,MAAK,IAAML,aACXQ,MAAM5B,aAAa6B,iBAOxB9B,EAAEiC,UAAUC,GAAG,QAAS,kBAAkB,WACtBlC,EAAEsC,MAAMY,MACZC,OAAOtC,OAAS,EACxBb,EAAE,cAAc2C,KAAK,YAAY,GAEjC3C,EAAE,cAAc2C,KAAK,YAAY"}