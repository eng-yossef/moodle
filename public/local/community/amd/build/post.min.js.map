{"version":3,"file":"post.min.js","sources":["../src/post.js"],"sourcesContent":["/**\n * Post details page logic.\n *\n * @module     local_community/post\n */\n\ndefine(['jquery'], function($) {\n\n    /**\n     * Initialize the post page.\n     *\n     * Loads the post details, answers, and sets up event handlers\n     * for adding answers and voting.\n     *\n     * @param {number} postid The ID of the post to load.\n     */\n    function init(postid) {\n\n        loadPost();\n\n        /**\n         * Fetch and render the post details and answers.\n         */\n        function loadPost() {\n            fetch(M.cfg.wwwroot + '/local/community/ajax/get_post.php?id=' + postid)\n                .then(res => res.json())\n                .then(function(data) {\n                    let html = `\n                        <h2>${data.post.title}</h2>\n                        <p>${data.post.content}</p>\n                        <hr>\n                        <h3>Answers</h3>\n                    `;\n\n                    data.answers.forEach(function(a) {\n                        html += `\n                            <div class=\"answer\">\n                                <p>${a.content}</p>\n                                <small>${a.firstname} ${a.lastname}</small>\n                                <button class=\"vote-answer\" data-id=\"${a.id}\" data-value=\"1\">▲</button>\n                                <button class=\"vote-answer\" data-id=\"${a.id}\" data-value=\"-1\">▼</button>\n                            </div>\n                        `;\n                    });\n\n                    html += `\n                        <textarea id=\"answercontent\"></textarea>\n                        <button id=\"addanswer\">Add Answer</button>\n                    `;\n\n                    $('#post-app').html(html);\n                });\n        }\n\n        // Add answer event\n        $(document).on('click', '#addanswer', function() {\n            const content = $('#answercontent').val();\n\n            fetch(M.cfg.wwwroot + '/local/community/ajax/create_answer.php', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify({\n                    postid: postid,\n                    content: content\n                })\n            }).then(loadPost);\n        });\n\n        // Vote answer event\n        $(document).on('click', '.vote-answer', function() {\n            fetch(M.cfg.wwwroot + '/local/community/ajax/vote.php', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify({\n                    answerid: $(this).data('id'),\n                    value: $(this).data('value')\n                })\n            });\n        });\n\n    }\n\n    return {\n        init: init\n    };\n\n});\n"],"names":["define","$","init","postid","loadPost","fetch","M","cfg","wwwroot","then","res","json","data","html","post","title","content","answers","forEach","a","firstname","lastname","id","document","on","val","method","headers","body","JSON","stringify","answerid","this","value"],"mappings":"AAMAA,8BAAO,CAAC,WAAW,SAASC,SAgFjB,CACHC,cAvEUC,iBAODC,WACLC,MAAMC,EAAEC,IAAIC,QAAU,yCAA2CL,QAC5DM,MAAKC,KAAOA,IAAIC,SAChBF,MAAK,SAASG,UACPC,6CACMD,KAAKE,KAAKC,mDACXH,KAAKE,KAAKE,8GAKnBJ,KAAKK,QAAQC,SAAQ,SAASC,GAC1BN,uGAEaM,EAAEH,gEACEG,EAAEC,sBAAaD,EAAEE,mGACaF,EAAEG,gHACFH,EAAEG,oGAKrDT,qKAKAZ,EAAE,aAAaY,KAAKA,SAhChCT,WAqCAH,EAAEsB,UAAUC,GAAG,QAAS,cAAc,iBAC5BR,QAAUf,EAAE,kBAAkBwB,MAEpCpB,MAAMC,EAAEC,IAAIC,QAAU,0CAA2C,CAC7DkB,OAAQ,OACRC,QAAS,gBACW,oBAEpBC,KAAMC,KAAKC,UAAU,CACjB3B,OAAQA,OACRa,QAASA,YAEdP,KAAKL,aAIZH,EAAEsB,UAAUC,GAAG,QAAS,gBAAgB,WACpCnB,MAAMC,EAAEC,IAAIC,QAAU,iCAAkC,CACpDkB,OAAQ,OACRC,QAAS,gBACW,oBAEpBC,KAAMC,KAAKC,UAAU,CACjBC,SAAU9B,EAAE+B,MAAMpB,KAAK,MACvBqB,MAAOhC,EAAE+B,MAAMpB,KAAK"}