{"version":3,"file":"post.min.js","sources":["../src/post.js"],"sourcesContent":["/**\n * Post details page logic for Moodle 5.1.\n *\n * @module     local_community/post\n * @copyright  2026 Youssef Khaled\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/notification'], function($, Notification) {\n\n    let currentPostId = null;\n\n    /**\n     * Render the post details and answers into the container.\n     *\n     * @param {Object} data The post and answers data.\n     */\n    function render(data) {\n        const {post, answers} = data;\n        let html = `\n            <div class=\"post-content mb-5\">\n                <h1 class=\"display-6 fw-bold text-dark\">${post.title}</h1>\n                <div class=\"d-flex align-items-center text-muted small mt-2 border-bottom pb-3\">\n                    <div class=\"me-3\"><i class=\"fa fa-user me-1\"></i> ${post.firstname} ${post.lastname}</div>\n                    <div class=\"badge bg-light text-dark border\">${post.votes} total votes</div>\n                </div>\n                <div class=\"mt-4 fs-5 text-dark\">${post.content}</div>\n            </div>\n            <h4 class=\"fw-bold mb-4\">${answers.length} Answers</h4>\n        `;\n\n        answers.forEach(a => {\n            html += `\n                <div class=\"card border-0 shadow-sm mb-3\">\n                    <div class=\"card-body d-flex\">\n                        <div class=\"d-flex flex-column align-items-center me-4 bg-light rounded p-2\"\n                             style=\"height: fit-content; min-width: 50px;\">\n                            <button class=\"btn btn-link link-success p-0 vote-answer\" data-id=\"${a.id}\" data-value=\"1\">\n                                <i class=\"fa fa-chevron-up\"></i>\n                            </button>\n                            <span class=\"fw-bold my-1\">${a.votes}</span>\n                            <button class=\"btn btn-link link-danger p-0 vote-answer\" data-id=\"${a.id}\" data-value=\"-1\">\n                                <i class=\"fa fa-chevron-down\"></i>\n                            </button>\n                        </div>\n                        <div class=\"flex-grow-1\">\n                            <div class=\"mb-2\">${a.content}</div>\n                            <div class=\"text-muted small\">Answered by <strong>${a.firstname}</strong></div>\n                        </div>\n                    </div>\n                </div>\n            `;\n        });\n\n        $('#post-data-container').html(html);\n    }\n\n    /**\n     * Refresh post data from the server.\n     */\n    function loadPost() {\n        fetch(`${M.cfg.wwwroot}/local/community/ajax/get_post.php?id=${currentPostId}`)\n            .then(res => res.json())\n            .then(render)\n            .catch(Notification.exception);\n    }\n\n    return {\n        /**\n         * Initialize the post page logic.\n         *\n         * @param {number} postid\n         */\n        init: function(postid) {\n            currentPostId = postid;\n            loadPost();\n\n            $(document).on('click', '#addanswer', function(e) {\n                e.preventDefault();\n\n                // Force Moodle editors (Atto/TinyMCE) to sync content back to the textarea.\n                if (window.tinyMCE) {\n                    window.tinyMCE.triggerSave();\n                }\n\n                const content = $('#answercontent').val();\n\n                if (!content || content.trim() === '') {\n                    Notification.alert('Error', 'Please enter an answer.', 'OK');\n                    return;\n                }\n\n                fetch(`${M.cfg.wwwroot}/local/community/ajax/create_answer.php`, {\n                    method: 'POST',\n                    headers: {'Content-Type': 'application/json'},\n                    body: JSON.stringify({postid: currentPostId, content: content})\n                })\n                .then(() => {\n                    // Reset the editor content.\n                    $('#answercontent').val('');\n                    if (window.tinyMCE && window.tinyMCE.activeEditor) {\n                        window.tinyMCE.activeEditor.setContent('');\n                    }\n                    loadPost();\n                    Notification.addNotification({message: 'Answer added!', type: 'success'});\n                })\n                .catch(Notification.exception);\n            });\n\n            $(document).on('click', '.vote-answer', function() {\n                fetch(`${M.cfg.wwwroot}/local/community/ajax/vote.php`, {\n                    method: 'POST',\n                    headers: {'Content-Type': 'application/json'},\n                    body: JSON.stringify({\n                        answerid: $(this).data('id'),\n                        postid: currentPostId,\n                        value: $(this).data('value')\n                    })\n                }).then(loadPost);\n            });\n        }\n    };\n});"],"names":["define","$","Notification","currentPostId","render","data","post","answers","html","title","firstname","lastname","votes","content","length","forEach","a","id","loadPost","fetch","M","cfg","wwwroot","then","res","json","catch","exception","init","postid","document","on","e","preventDefault","window","tinyMCE","triggerSave","val","trim","method","headers","body","JSON","stringify","activeEditor","setContent","addNotification","message","type","alert","answerid","this","value"],"mappings":";;;;;;;AAOAA,8BAAO,CAAC,SAAU,sBAAsB,SAASC,EAAGC,kBAE5CC,cAAgB,cAOXC,OAAOC,YACNC,KAACA,KAADC,QAAOA,SAAWF,SACpBG,sHAE8CF,KAAKG,gMAESH,KAAKI,sBAAaJ,KAAKK,6FAC5BL,KAAKM,8GAErBN,KAAKO,oFAEjBN,QAAQO,kCAGvCP,QAAQQ,SAAQC,IACZR,oZAKqFQ,EAAEC,iMAG1CD,EAAEJ,wHACqCI,EAAEC,8QAKlDD,EAAEH,yGAC8BG,EAAEN,kIAO1ET,EAAE,wBAAwBO,KAAKA,eAM1BU,WACLC,gBAASC,EAAEC,IAAIC,yDAAgDnB,gBAC1DoB,MAAKC,KAAOA,IAAIC,SAChBF,KAAKnB,QACLsB,MAAMxB,aAAayB,iBAGrB,CAMHC,KAAM,SAASC,QACX1B,cAAgB0B,OAChBX,WAEAjB,EAAE6B,UAAUC,GAAG,QAAS,cAAc,SAASC,GAC3CA,EAAEC,iBAGEC,OAAOC,SACPD,OAAOC,QAAQC,oBAGbvB,QAAUZ,EAAE,kBAAkBoC,MAE/BxB,SAA8B,KAAnBA,QAAQyB,OAKxBnB,gBAASC,EAAEC,IAAIC,mDAAkD,CAC7DiB,OAAQ,OACRC,QAAS,gBAAiB,oBAC1BC,KAAMC,KAAKC,UAAU,CAACd,OAAQ1B,cAAeU,QAASA,YAEzDU,MAAK,KAEFtB,EAAE,kBAAkBoC,IAAI,IACpBH,OAAOC,SAAWD,OAAOC,QAAQS,cACjCV,OAAOC,QAAQS,aAAaC,WAAW,IAE3C3B,WACAhB,aAAa4C,gBAAgB,CAACC,QAAS,gBAAiBC,KAAM,eAEjEtB,MAAMxB,aAAayB,WAlBhBzB,aAAa+C,MAAM,QAAS,0BAA2B,SAqB/DhD,EAAE6B,UAAUC,GAAG,QAAS,gBAAgB,WACpCZ,gBAASC,EAAEC,IAAIC,0CAAyC,CACpDiB,OAAQ,OACRC,QAAS,gBAAiB,oBAC1BC,KAAMC,KAAKC,UAAU,CACjBO,SAAUjD,EAAEkD,MAAM9C,KAAK,MACvBwB,OAAQ1B,cACRiD,MAAOnD,EAAEkD,MAAM9C,KAAK,aAEzBkB,KAAKL"}