{"version":3,"file":"post.min.js","sources":["../src/post.js"],"sourcesContent":["/**\n * Post details page logic.\n *\n * @module local_community/post\n */\ndefine(['jquery'], function($) {\n\n    /**\n     * Initialize the post page.\n     *\n     * Loads the post details, answers, and sets up event handlers\n     * for adding answers and voting.\n     *\n     * @param {number} postid The ID of the post to load.\n     */\n    function init(postid) {\n        loadPost();\n\n        /**\n         * Fetch and render the post details and answers.\n         *\n         * Calls backend endpoint to get post data and renders HTML.\n         */\n        function loadPost() {\n            fetch(M.cfg.wwwroot + '/local/community/ajax/get_post.php?id=' + postid)\n                .then(res => res.json())\n                .then(function(data) {\n                    let html = `\n                        <h2>${data.post.title}</h2>\n                        <p>${data.post.content}</p>\n                        <div class=\"votes\">${data.post.votes} votes</div>\n                        <hr>\n                        <h3>Answers</h3>\n                    `;\n\n                    data.answers.forEach(function(a) {\n                        html += `\n                            <div class=\"answer\">\n                                <p>${a.content}</p>\n                                <small>${a.firstname} ${a.lastname}</small>\n                                <div class=\"votes\">${a.votes}</div>\n                                <button class=\"vote-answer\" data-id=\"${a.id}\" data-value=\"1\">▲</button>\n                                <button class=\"vote-answer\" data-id=\"${a.id}\" data-value=\"-1\">▼</button>\n                            </div>\n                        `;\n                    });\n\n                    $('#post-app').html(html);\n                });\n        }\n\n        /**\n         * Handle add answer button click.\n         *\n         * Reads content from the editor textarea and posts it to backend.\n         */\n        $(document).on('click', '#addanswer', function() {\n            const content = $('#answercontent').val(); // Atto/TinyMCE keeps textarea synced\n\n            fetch(M.cfg.wwwroot + '/local/community/ajax/create_answer.php', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({\n                    postid: postid,\n                    content: content\n                })\n            }).then(loadPost);\n        });\n\n        /**\n         * Handle vote button click.\n         *\n         * Sends vote value to backend for the selected answer.\n         */\n        $(document).on('click', '.vote-answer', function() {\n            fetch(M.cfg.wwwroot + '/local/community/ajax/vote.php', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({\n                    answerid: $(this).data('id'),\n                    postid: postid,\n                    value: $(this).data('value')\n                })\n            });\n        });\n    }\n\n    return { init: init };\n});\n"],"names":["define","$","init","postid","loadPost","fetch","M","cfg","wwwroot","then","res","json","data","html","post","title","content","votes","answers","forEach","a","firstname","lastname","id","document","on","val","method","headers","body","JSON","stringify","answerid","this","value"],"mappings":"AAKAA,8BAAO,CAAC,WAAW,SAASC,SAkFjB,CAAEC,cAxEKC,iBAQDC,WACLC,MAAMC,EAAEC,IAAIC,QAAU,yCAA2CL,QAC5DM,MAAKC,KAAOA,IAAIC,SAChBF,MAAK,SAASG,UACPC,6CACMD,KAAKE,KAAKC,mDACXH,KAAKE,KAAKE,oEACMJ,KAAKE,KAAKG,oHAKnCL,KAAKM,QAAQC,SAAQ,SAASC,GAC1BP,uGAEaO,EAAEJ,gEACEI,EAAEC,sBAAaD,EAAEE,iFACLF,EAAEH,8FACgBG,EAAEG,gHACFH,EAAEG,oGAKrDtB,EAAE,aAAaY,KAAKA,SA/BhCT,WAwCAH,EAAEuB,UAAUC,GAAG,QAAS,cAAc,iBAC5BT,QAAUf,EAAE,kBAAkByB,MAEpCrB,MAAMC,EAAEC,IAAIC,QAAU,0CAA2C,CAC7DmB,OAAQ,OACRC,QAAS,gBAAkB,oBAC3BC,KAAMC,KAAKC,UAAU,CACjB5B,OAAQA,OACRa,QAASA,YAEdP,KAAKL,aAQZH,EAAEuB,UAAUC,GAAG,QAAS,gBAAgB,WACpCpB,MAAMC,EAAEC,IAAIC,QAAU,iCAAkC,CACpDmB,OAAQ,OACRC,QAAS,gBAAkB,oBAC3BC,KAAMC,KAAKC,UAAU,CACjBC,SAAU/B,EAAEgC,MAAMrB,KAAK,MACvBT,OAAQA,OACR+B,MAAOjC,EAAEgC,MAAMrB,KAAK"}