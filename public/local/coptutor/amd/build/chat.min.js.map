{"version":3,"file":"chat.min.js","sources":["../src/chat.js"],"sourcesContent":["define(['jquery'], function($) {\n    return {\n        init: function(courseid) {\n            // 1. Inject Styles dynamically (Broken into shorter lines for ESLint)\n            let styles = '<style>';\n            styles += '#ai-chat-wrapper { position: fixed; bottom: 20px; right: 20px; z-index: 9999; ';\n            styles += \"font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }\";\n            styles += '#ai-chat-icon { width: 60px; height: 60px; background: #007bff; border-radius: 50%; ';\n            styles += 'display: flex; align-items: center; justify-content: center; cursor: pointer; ';\n            styles += 'box-shadow: 0 4px 15px rgba(0,0,0,0.2); transition: transform 0.3s; }';\n            styles += '#ai-chat-icon:hover { transform: scale(1.1); }';\n            styles += '#ai-chat-window { display: none; width: 350px; height: 500px; background: #fff; ';\n            styles += 'border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.15); flex-direction: column; ';\n            styles += 'overflow: hidden; margin-bottom: 15px; border: 1px solid #eee; }';\n            styles += '#ai-chat-header { background: #007bff; color: white; padding: 15px; ';\n            styles += 'font-weight: bold; display: flex; justify-content: space-between; }';\n            styles += '#ai-chat-body { flex: 1; padding: 15px; overflow-y: auto; background: #f9f9f9; ';\n            styles += 'display: flex; flex-direction: column; gap: 10px; }';\n            styles += '.chat-bubble { padding: 10px 14px; border-radius: 15px; max-width: 80%; ';\n            styles += 'font-size: 14px; line-height: 1.4; }';\n            styles += '.user-msg { background: #007bff; color: white; align-self: flex-end; ';\n            styles += 'border-bottom-right-radius: 2px; }';\n            styles += '.ai-msg { background: #e9e9eb; color: #333; align-self: flex-start; ';\n            styles += 'border-bottom-left-radius: 2px; }';\n            styles += '#ai-chat-footer { padding: 10px; border-top: 1px solid #eee; display: flex; gap: 5px; }';\n            styles += '#ai-chat-input { flex: 1; border: 1px solid #ddd; border-radius: 20px; ';\n            styles += 'padding: 8px 15px; outline: none; resize: none; height: 40px; }';\n            styles += '#ai-chat-send { background: #007bff; color: white; border: none; ';\n            styles += 'border-radius: 50%; width: 40px; height: 40px; cursor: pointer; }';\n            styles += '.typing { font-style: italic; font-size: 12px; color: #888; }';\n            styles += '</style>';\n\n            // 2. Chat HTML structure (SVG and long lines broken down)\n            const chatHTML = `\n                <div id=\"ai-chat-wrapper\">\n                    <div id=\"ai-chat-window\">\n                        <div id=\"ai-chat-header\">\n                            <span>AI Course Assistant</span>\n                            <span id=\"close-chat\" style=\"cursor:pointer\">&times;</span>\n                        </div>\n                        <div id=\"ai-chat-body\">\n                            <div class=\"chat-bubble ai-msg\">Hello! How can I help you today?</div>\n                        </div>\n                        <div id=\"ai-chat-footer\">\n                            <textarea id=\"ai-chat-input\" placeholder=\"Ask a question...\"></textarea>\n                            <button id=\"ai-chat-send\">âž¤</button>\n                        </div>\n                    </div>\n                    <div id=\"ai-chat-icon\">\n                        <svg width=\"30\" height=\"30\" viewBox=\"0 0 24 24\" fill=\"white\">\n                            <path d=\"M12 2C6.47 2 2 6.47 2 12c0 1.91.54 3.68 1.46 5.2L2 22l4.8-1.46\n                            c1.52.92 3.29 1.46 5.2 1.46 5.53 0 10-4.47 10-10S17.53 2 12 2zm0\n                            18c-1.65 0-3.19-.45-4.52-1.24l-.32-.19-2.69.82.82-2.69-.19-.32\n                            C4.45 15.19 4 13.65 4 12c0-4.41 3.59-8 8-8s8 3.59 8 8-3.59 8-8 8z\"/>\n                        </svg>\n                    </div>\n                </div>`;\n\n            $('body').append(styles + chatHTML);\n\n            const scrollToBottom = function() {\n                const body = $('#ai-chat-body');\n                if (body.length) {\n                    body.scrollTop(body[0].scrollHeight);\n                }\n            };\n\n            const sendMessage = function() {\n                const message = $('#ai-chat-input').val().trim();\n                if (!message) {\n                    return;\n                }\n\n                $('#ai-chat-body').append(`<div class=\"chat-bubble user-msg\">${message}</div>`);\n                $('#ai-chat-input').val('');\n\n                const loadingId = 'loading-' + Date.now();\n                $('#ai-chat-body').append(`<div id=\"${loadingId}\" class=\"typing\">AI is thinking...</div>`);\n                scrollToBottom();\n\n                fetch(M.cfg.wwwroot + '/local/coptutor/ajax.php', {\n                    method: 'POST',\n                    headers: {'Content-Type': 'application/json'},\n                    body: JSON.stringify({message: message, courseid: courseid})\n                })\n                .then(function(res) {\n                    return res.json();\n                })\n                .then(function(data) {\n                    $(`#${loadingId}`).remove();\n                    $('#ai-chat-body').append(`<div class=\"chat-bubble ai-msg\">${data.reply}</div>`);\n                    scrollToBottom();\n                })\n                .catch(function() {\n                    $(`#${loadingId}`).text(\"Error: Could not connect to AI.\");\n                });\n            };\n\n            // Toggle Window\n            $('#ai-chat-icon, #close-chat').click(function() {\n                $('#ai-chat-window').fadeToggle(200).css('display', function(_, current) {\n                    return current === 'none' ? 'none' : 'flex';\n                });\n            });\n\n            $('#ai-chat-send').click(sendMessage);\n\n            $('#ai-chat-input').keypress(function(e) {\n                if (e.which === 13 && !e.shiftKey) {\n                    e.preventDefault();\n                    sendMessage();\n                }\n            });\n        }\n    };\n});"],"names":["define","$","init","courseid","styles","append","scrollToBottom","body","length","scrollTop","scrollHeight","sendMessage","message","val","trim","loadingId","Date","now","fetch","M","cfg","wwwroot","method","headers","JSON","stringify","then","res","json","data","remove","reply","catch","text","click","fadeToggle","css","_","current","keypress","e","which","shiftKey","preventDefault"],"mappings":"AAAAA,6BAAO,CAAC,WAAW,SAASC,SACjB,CACHC,KAAM,SAASC,cAEPC,OAAS,UACbA,QAAU,iFACVA,QAAU,mEACVA,QAAU,uFACVA,QAAU,iFACVA,QAAU,wEACVA,QAAU,iDACVA,QAAU,mFACVA,QAAU,yFACVA,QAAU,mEACVA,QAAU,uEACVA,QAAU,sEACVA,QAAU,kFACVA,QAAU,sDACVA,QAAU,2EACVA,QAAU,uCACVA,QAAU,wEACVA,QAAU,qCACVA,QAAU,uEACVA,QAAU,oCACVA,QAAU,0FACVA,QAAU,0EACVA,QAAU,kEACVA,QAAU,oEACVA,QAAU,oEACVA,QAAU,gEACVA,QAAU,WA4BVH,EAAE,QAAQI,OAAOD,2+FAEXE,eAAiB,iBACbC,KAAON,EAAE,iBACXM,KAAKC,QACLD,KAAKE,UAAUF,KAAK,GAAGG,eAIzBC,YAAc,iBACVC,QAAUX,EAAE,kBAAkBY,MAAMC,WACrCF,eAILX,EAAE,iBAAiBI,mDAA4CO,mBAC/DX,EAAE,kBAAkBY,IAAI,UAElBE,UAAY,WAAaC,KAAKC,MACpChB,EAAE,iBAAiBI,0BAAmBU,uDACtCT,iBAEAY,MAAMC,EAAEC,IAAIC,QAAU,2BAA4B,CAC9CC,OAAQ,OACRC,QAAS,gBAAiB,oBAC1BhB,KAAMiB,KAAKC,UAAU,CAACb,QAASA,QAAST,SAAUA,aAErDuB,MAAK,SAASC,YACJA,IAAIC,UAEdF,MAAK,SAASG,MACX5B,aAAMc,YAAae,SACnB7B,EAAE,iBAAiBI,iDAA0CwB,KAAKE,iBAClEzB,oBAEH0B,OAAM,WACH/B,aAAMc,YAAakB,KAAK,uCAKhChC,EAAE,8BAA8BiC,OAAM,WAClCjC,EAAE,mBAAmBkC,WAAW,KAAKC,IAAI,WAAW,SAASC,EAAGC,eACzC,SAAZA,QAAqB,OAAS,aAI7CrC,EAAE,iBAAiBiC,MAAMvB,aAEzBV,EAAE,kBAAkBsC,UAAS,SAASC,GAClB,KAAZA,EAAEC,OAAiBD,EAAEE,WACrBF,EAAEG,iBACFhC"}